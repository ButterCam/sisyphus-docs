<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://sisyphus.bybutter.com/blog</id>
    <title>Sisyphus Blog</title>
    <updated>2022-10-18T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://sisyphus.bybutter.com/blog"/>
    <subtitle>Sisyphus Blog</subtitle>
    <icon>https://sisyphus.bybutter.com/img/favicon.svg</icon>
    <entry>
        <title type="html"><![CDATA[New docker plugin]]></title>
        <id>new-docker-plugin</id>
        <link href="https://sisyphus.bybutter.com/blog/new-docker-plugin"/>
        <updated>2022-10-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Sisyphus 1.5.20, we have further optimized the Docker plugin to make it easier to use.]]></summary>
        <content type="html"><![CDATA[<p>In Sisyphus 1.5.20, we have further optimized the Docker plugin to make it easier to use.</p><p>The main tweaks include changes to the base Docker plugin, automatic Dockerfile generation, and support for Spring
layered jar builds.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-started">How it started<a class="hash-link" href="#how-it-started" title="Direct link to heading">​</a></h2><p>We've been using GitHub Action as our CI tool, and when we create a PullRequest, CI automatically compiles a SNAPSHOT
version of the image to deploy the test environment. After the PR merge, the CI compiles a SNAPSHOT version with branch
names to deploy the beta environment. The final deployment image is actually compiled when the Release is created.</p><p>As you can see, we need to build the image three times in the whole CI pipeline, and each build takes about 40 minutes,
which can take close to two hours from the time the PR is raised to the final release.</p><p>And due to the recent internal CI flow resource consumption problem, our backend service has been taking three hours for
one build, so until the CI flow resource problem is solved, we have to optimize our CI pipeline.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-optimized">How it optimized<a class="hash-link" href="#how-it-optimized" title="Direct link to heading">​</a></h2><p>First of all, in the actual use process, the SNAPSHOT version of the PR build image is generally not used, most cases
are used to deploy the test environment of the developer's local build image, so we can remove the PR image build step,
just do some code checking.</p><p>Second, the SNAPSHOT version built for each branch is actually the same as the RELEASE version in the final release, but
due to the subtle differences in the build environment, the compilation result is not cached, and the branch building
still needs to be run again for each release. So for this, we plan to reuse the image compiled from the previous branch
built.</p><p>In previous versions, we used <a href="https://github.com/palantir/gradle-docker" target="_blank" rel="noopener noreferrer">palantir/gradle-docker</a> as our base Docker
plugin, for which we also optimized the design of the tag task.</p><p>However, during this CI pipeline optimization, we found some shortcomings, such as no <code>docker save</code> support and no easy
way to get the current build image ID.</p><p>So we switched the base Docker plugin
to <a href="https://github.com/bmuschko/gradle-docker-plugin" target="_blank" rel="noopener noreferrer">bmuschko/gradle-docker-plugin</a>, which provides more underlying
operational capabilities.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-dockerfile-with-spring-layered-jar">Generated dockerfile with Spring Layered Jar<a class="hash-link" href="#generated-dockerfile-with-spring-layered-jar" title="Direct link to heading">​</a></h2><p>In our previous usage, our Dockerfile was written manually, while the new base Docker plugin provides the ability to
automatically generate a Dockerfile, so we intend to generate Dockerfile automatically by the plugin.</p><p>Previously, our Dockerfile was written according to Spring Boot's Layered Jar hierarchy, which looked something like
this.</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> amazoncorretto:17 </span><span class="token instruction keyword" style="color:#00009f">as</span><span class="token instruction"> builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> PROJECT_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> PROJECT_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PROJECT_NAME=</span><span class="token instruction variable" style="color:#36acaa">$PROJECT_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PROJECT_VERSION=</span><span class="token instruction variable" style="color:#36acaa">$PROJECT_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction string" style="color:#e3116c">"${PROJECT_NAME}-${PROJECT_VERSION}.jar"</span><span class="token instruction"> application.jar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> java -Djarmode=layertools -jar application.jar extract</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--platform</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">linux/amd64</span><span class="token instruction"> amd64/amazoncorretto:17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> PROJECT_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> PROJECT_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PROJECT_NAME=</span><span class="token instruction variable" style="color:#36acaa">$PROJECT_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PROJECT_VERSION=</span><span class="token instruction variable" style="color:#36acaa">$PROJECT_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction"> dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction"> spring-boot-loader/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction"> sisyphus-dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction"> butter-dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction"> snapshot-dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction"> application/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:#e3116c">"java"</span><span class="token instruction">, </span><span class="token instruction string" style="color:#e3116c">"org.springframework.boot.loader.JarLauncher"</span><span class="token instruction">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Spring Boot 2.3 added support
for <a href="https://spring.io/blog/2020/08/14/creating-efficient-docker-images-with-spring-boot-2-3" target="_blank" rel="noopener noreferrer">Layered Jar</a>, which allows
you to layer dependencies and application packages. We use this feature in Dockerfile to layer different dependencies
according to their update frequency, putting infrequently updated dependencies in the bottom layer and frequently
updated dependencies in the top layer, so that when we upgrade only the frequently changed components, we can reuse the
previous bottom image, thus speeding up the image build.</p><p>So we used Docker's builder mode to decompress the Layered Jar to a temporary Docker pod, and then copied the
decompressed layers into the final image in hierarchical order.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">withType</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BootJar</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layered </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        application </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">intoLayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal singleline string" style="color:#e3116c">"spring-boot-loader"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">include</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">"org</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">springframework</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">boot</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">loader</span><span class="token comment" style="color:#999988;font-style:italic">/**")</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            intoLayer("application")</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        dependencies {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            intoLayer("snapshot-dependencies") {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                include("*:*:*SNAPSHOT")</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            intoLayer("sisyphus-dependencies") {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                include("com.bybutter.sisyphus.*:*:*")</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            intoLayer("butter-dependencies") {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">                include("com.bybutter.*:*:*")</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            intoLayer("dependencies")</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        layerOrder = listOf(</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            "dependencies",</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            "spring-boot-loader",</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            "sisyphus-dependencies",</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            "butter-dependencies",</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            "snapshot-dependencies",</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">            "application"</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above configuration, we have roughly divided the code into 6 layers:</p><ol><li>dependencies<br>This layer contains all the third-party dependencies.</li><li>spring-boot-loader<br>This layer contains the Spring Boot loader.</li><li>sisyphus-dependencies<br>This layer contains all the Sisyphus dependencies. Sisyphus often does some iterative upgrades due to business needs,
so it is separated from the common dependencies.</li><li>butter-dependencies<br>This layer contains all our internal dependencies and is closely related to the business.</li><li>snapshot-dependencies<br>This layer contains all the SNAPSHOT version dependencies as snapshot versions, which may change during development.</li><li>application<br>This layer contains the business code and is the most frequently updated layer.</li></ol><p>The new Sisyphus Docker plugin automatically reads the layering information from the bootJar task and generates a
layered decompression task to decompress the bootJar layering to the Docker build's working directory.</p><p>Then the <code>dockerfile</code> task generates the Dockerfile needed for the build.</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> PROJECT_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> PROJECT_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> amazoncorretto:17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PROJECT_NAME=</span><span class="token instruction variable" style="color:#36acaa">$PROJECT_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PROJECT_VERSION=</span><span class="token instruction variable" style="color:#36acaa">$PROJECT_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> spring-boot-loader/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> sisyphus-dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> butter-dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> snapshot-dependencies/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> application/ ./</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:#e3116c">"java"</span><span class="token instruction">, </span><span class="token instruction string" style="color:#e3116c">"org.springframework.boot.loader.JarLauncher"</span><span class="token instruction">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apply-to-ci-pipeline">Apply to CI pipeline<a class="hash-link" href="#apply-to-ci-pipeline" title="Direct link to heading">​</a></h2><p>The new Docker plugin automatically generates a file containing the image IDs when it is built, and we collect these
image IDs during the build of the branch SNAPSHOT version and store them in an attachment to the draft release.</p><p>Re-tagging these image IDs with the release version during the Release build pipeline to saves image build time.</p><p>In fact, at the beginning, our original design was to save the branch SNAPSHOT image as a file via docker save and then
load it and re-tag as release version, but this would result in an oversized Release attachment, so we finally chose to
re-tag it using the image ID.</p>]]></content>
        <author>
            <name>HIGAN</name>
            <uri>https://github.com/devkanro</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="sisyphus-project-plugin" term="sisyphus-project-plugin"/>
        <category label="gradle" term="gradle"/>
        <category label="release" term="release"/>
    </entry>
</feed>