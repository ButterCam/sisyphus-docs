"use strict";(self.webpackChunksisyphus_docs=self.webpackChunksisyphus_docs||[]).push([[2142],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=l(n),g=a,h=c["".concat(p,".").concat(g)]||c[g]||d[g]||r;return n?o.createElement(h,i(i({ref:t},u),{},{components:n})):o.createElement(h,i({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=c;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4684:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var o=n(7462),a=(n(7294),n(3905));const r={sidebar_position:5},i="Design new API",s={unversionedId:"guides/design-your-api",id:"guides/design-your-api",title:"Design new API",description:"The beginning and core of Sisyphus' workflow is the API design, around which everything revolves. Here Sisyphus strongly",source:"@site/docs/guides/design-your-api.md",sourceDirName:"guides",slug:"/guides/design-your-api",permalink:"/docs/guides/design-your-api",draft:!1,editUrl:"https://github.com/ButterCam/sisyphus-docs/edit/main/docs/guides/design-your-api.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"HTTP Transcoding",permalink:"/docs/guides/http-transcoding"},next:{title:"Congratulations!",permalink:"/docs/guides/congratulations"}},p={},l=[{value:"Intellij Protobuf Plugin",id:"intellij-protobuf-plugin",level:2},{value:"Designing the first API",id:"designing-the-first-api",level:2},{value:"Resource-oriented design",id:"resource-oriented-design",level:2},{value:"Resource Name",id:"resource-name",level:3},{value:"Resource Type",id:"resource-type",level:3},{value:"Resource Reference",id:"resource-reference",level:3},{value:"API Deigning",id:"api-deigning",level:2},{value:"Get Method",id:"get-method",level:3},{value:"List Method",id:"list-method",level:3},{value:"Create Method",id:"create-method",level:3},{value:"Update Method",id:"update-method",level:3},{value:"Delete Method",id:"delete-method",level:3},{value:"Custom Method",id:"custom-method",level:3}],u={toc:l};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,o.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"design-new-api"},"Design new API"),(0,a.kt)("p",null,"The beginning and core of Sisyphus' workflow is the API design, around which everything revolves. Here Sisyphus strongly\nrecommends referring to the ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/"},"Google API Improvement Proposals")," and following it to design API."),(0,a.kt)("p",null,"This guide contains Google's best practices for API design. When you encounter a problem with API design and feel\nuncertain about doing this or that, take a look at ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/"},"Google API Improvement Proposals"),"\u3002"),(0,a.kt)("h2",{id:"intellij-protobuf-plugin"},"Intellij Protobuf Plugin"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"https://github.com/devkanro/intellij-protobuf-plugin"},"Intellij Protobuf Plugin"))," is a plugin for Intellij's Protobuf\nlanguage plugin that helps you write Protobuf files quickly."),(0,a.kt)("p",null,"The plugin provides many features that the official plugin does not have, such as AIP integration, import optimization,\netc., and also integrates some features of Sisyphus hold."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(6474).Z+"#gh-light-mode-only",width:"2188",height:"1648"}),"\n",(0,a.kt)("img",{src:n(3028).Z+"#gh-dark-mode-only",width:"2188",height:"1648"})),(0,a.kt)("p",null,"You can download and install the plugin by searching for ",(0,a.kt)("inlineCode",{parentName:"p"},"protobuf")," in Intellij's ",(0,a.kt)("inlineCode",{parentName:"p"},"Preferences - Plugins")," page."),(0,a.kt)("admonition",{title:"Attention",type:"danger"},(0,a.kt)("p",{parentName:"admonition"},"Note that when you use IntelliJ IDEA Ultimate, an official Protocol Buffer plugin is bundled, Intellij Protobuf Plugin\nis not compatible with this plugin, you need to disable the ",(0,a.kt)("inlineCode",{parentName:"p"},"Protocol Buffer")," plugin and the ",(0,a.kt)("inlineCode",{parentName:"p"},"gRPC")," plugin on the\nplugins page."),(0,a.kt)("p",{parentName:"admonition"},"Don't worry, because the Intellij Protobuf Plugin already integrates most of the features of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Protocol Buffer"),"\nplugin and the ",(0,a.kt)("inlineCode",{parentName:"p"},"gRPC")," plugin, and provides more and smarter features.")),(0,a.kt)("h2",{id:"designing-the-first-api"},"Designing the first API"),(0,a.kt)("p",null,"Once the plugin is installed, a new proto file can be created in the ",(0,a.kt)("inlineCode",{parentName:"p"},"src/main/proto")," directory."),(0,a.kt)("p",null,"Before creating the file, you need to create a new package, refer to ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/191"},"AIP-191"),"."),(0,a.kt)("p",null,"In general, Java package names can be proto package names by simply dropping root domains like ",(0,a.kt)("inlineCode",{parentName:"p"},"com"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"net"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"io"),", etc."),(0,a.kt)("p",null,"Here we use ",(0,a.kt)("inlineCode",{parentName:"p"},"bybutter.showcase.v1")," as our package name and create a ",(0,a.kt)("inlineCode",{parentName:"p"},"book.proto")," under this package."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage bybutter.showcase.v1;\n\noption java_package = "com.bybutter.showcase.v1";\noption java_multiple_files = true;\n')),(0,a.kt)("p",null,"For newly created proto files, it is always encouraged to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"proto3")," syntax and configure the package name of the\nresulting Kotlin file."),(0,a.kt)("h2",{id:"resource-oriented-design"},"Resource-oriented design"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/121"},"AIP-121")," introduced the concept of Resource Oriented Design, a pattern for RPC APIs that\nprovides a more prescriptive and schematic approach to designing APIs."),(0,a.kt)("p",null,"Design almost all APIs as different actions against resources, and most of the actions can be described using HTTP\nmethods, which is almost the same concept as Restful API."),(0,a.kt)("p",null,"Here we define a resource named ",(0,a.kt)("inlineCode",{parentName:"p"},"Book"),", which represents information about a book."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},"message Book {\n    // \u6807\u9898\n    string title = 1;\n    // \u4f5c\u8005\n    string author = 2;\n}\n")),(0,a.kt)("h3",{id:"resource-name"},"Resource Name"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/122"},"AIP-122")," defines a resource name specification that uniquely identifies a resource, which\ncontains not only the resource ID."),(0,a.kt)("p",null,"It also contains information about the hierarchy between resources, which is useful for designing complex APIs."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'message Book {\n    option (google.api.resource) = {\n        type: "showcase.bybutter.com/Book"\n        pattern: "publishers/{publisher}/books/{book}"\n    };\n\n    string name = 1;\n    // \u6807\u9898\n    string title = 2;\n    // \u4f5c\u8005\n    string author = 3;\n}\n')),(0,a.kt)("p",null,"A message can be defined as a resource using the ",(0,a.kt)("inlineCode",{parentName:"p"},"resource")," option, where we define Book resource name in the\nformat ",(0,a.kt)("inlineCode",{parentName:"p"},"publishers/{publisher}/books/{book}"),", where ",(0,a.kt)("inlineCode",{parentName:"p"},"publisher")," is the publisher ID and ",(0,a.kt)("inlineCode",{parentName:"p"},"book")," is the book ID."),(0,a.kt)("h3",{id:"resource-type"},"Resource Type"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/123"},"AIP-123")," defines the specification of the resource type, which consists of the domain in\nwhich the resource is located and the resource type."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"showcase.bybutter.com/Book")," is the resource type of ",(0,a.kt)("inlineCode",{parentName:"p"},"Book"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"showcase.bybutter.com")," indicates the domain to which the\nresource belongs, typically the domain name of the API server, and Book is the resource type, usually the message name."),(0,a.kt)("h3",{id:"resource-reference"},"Resource Reference"),(0,a.kt)("p",null,"We can associate different resources with each other, and the ",(0,a.kt)("inlineCode",{parentName:"p"},"resource_reference")," option can do that."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'message Book {\n    // \u4f5c\u8005\n    string author = 3 [(google.api.resource_reference) = {\n        type: "showcase.bybutter.com/Author"\n    }];\n}\n')),(0,a.kt)("h2",{id:"api-deigning"},"API Deigning"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/131"},"AIP-131"),", ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/132"},"AIP-132"),", ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/133"},"AIP-133"),"\n, ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/134"},"AIP-134"),", ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/135"},"AIP-135")," defines five standard interfaces on\nresources, which are Get, List, Create, Update, Delete."),(0,a.kt)("p",null,"This is what we often call the add, delete, and check interface, these interfaces have their own AIP specification,\nreference to these specifications can be designed to robust and expandable API."),(0,a.kt)("h3",{id:"get-method"},"Get Method"),(0,a.kt)("p",null,"The Get method is used to get detailed information about a single resource by its name, which is often placed in the URI\npath in HTTP mappings."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'service BookApi {\n    rpc GetBook (GetBookRequest) returns (Book) {\n        option (google.api.http) = {\n            get: "/v1/{name=publishers/*/books/*}"\n        };\n        option (google.api.method_signature) = "name";\n    }\n}\n\nmessage GetBookRequest {\n    string name = 1 [\n        (google.api.field_behavior) = REQUIRED,\n        (google.api.resource_reference) = {\n            type: "library.googleapis.com/Book"\n        }];\n}\n')),(0,a.kt)("h3",{id:"list-method"},"List Method"),(0,a.kt)("p",null,"The List method is used to list resources, often with the parent resource name of the resource in the URI path in the\nHTTP mapping, and with ",(0,a.kt)("inlineCode",{parentName:"p"},"page_token")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"page_size")," for pagination."),(0,a.kt)("p",null,"Additional ",(0,a.kt)("inlineCode",{parentName:"p"},"filter"),"(",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/160"},"AIP-160"),") and ",(0,a.kt)("inlineCode",{parentName:"p"},"order_by")," resources can be designed to filter resources\nand set rules for sorting resources in the list."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'service BookApi {\n    rpc ListBooks (ListBooksRequest) returns (ListBooksResponse) {\n        option (google.api.http) = {\n            get: "/v1/{parent=publishers/*}/books"\n        };\n        option (google.api.method_signature) = "parent";\n    }\n}\n\nmessage ListBooksRequest {\n    string parent = 1 [\n        (google.api.field_behavior) = REQUIRED,\n        (google.api.resource_reference) = {\n            child_type: "library.googleapis.com/Book"\n        }];\n\n    int32 page_size = 2;\n\n    // The page token obtained from the response to the previous ListBooks request, or from the first page if not specified.\n    string page_token = 3;\n}\n\nmessage ListBooksResponse {\n    repeated Book books = 1;\n\n    // The next page token, or null if there is no more data.\n    string next_page_token = 2;\n}\n')),(0,a.kt)("h3",{id:"create-method"},"Create Method"),(0,a.kt)("p",null,"The Create method is used to create a resource, often putting the name of the resource it belongs to in the URI path in\nthe HTTP mapping, and putting information about the resource itself in the request body, returning the created resource\nitself."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'service BookApi {\n    rpc CreateBook (CreateBookRequest) returns (Book) {\n        option (google.api.http) = {\n            post: "/v1/{parent=publishers/*}/books"\n            body: "book"\n        };\n        option (google.api.method_signature) = "parent,book";\n    }\n}\n\nmessage CreateBookRequest {\n    string parent = 1 [\n        (google.api.field_behavior) = REQUIRED,\n        (google.api.resource_reference) = {\n            child_type: "library.googleapis.com/Book"\n        }];\n\n    // The book to create.\n    Book book = 2 [(google.api.field_behavior) = REQUIRED];\n}\n')),(0,a.kt)("h3",{id:"update-method"},"Update Method"),(0,a.kt)("p",null,"The Update method is used to update a resource, often placing the resource name in the URI path in the HTTP transcoding\nand placing information about the resource itself in the request body, returning the updated resource itself."),(0,a.kt)("p",null,"The Update method will also contain an ",(0,a.kt)("inlineCode",{parentName:"p"},"update_mask")," field to indicate which resources' fields need to be updated."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'service BookApi {\n    rpc UpdateBook (UpdateBookRequest) returns (Book) {\n        option (google.api.http) = {\n            patch: "/v1/{book.name=publishers/*/books/*}"\n            body: "book"\n        };\n        option (google.api.method_signature) = "book,update_mask";\n    }\n}\n\nmessage UpdateBookRequest {\n    // The book to update.\n    //\n    // The book\'s `name` field is used to identify the book to update.\n    // Format: publishers/{publisher}/books/{book}\n    Book book = 1 [(google.api.field_behavior) = REQUIRED];\n\n    // The list of fields to update.\n    google.protobuf.FieldMask update_mask = 2;\n}\n')),(0,a.kt)("h3",{id:"delete-method"},"Delete Method"),(0,a.kt)("p",null,"The Delete method is used to delete a resource, and in HTTP transcoding often puts the resource name into the URI path,\nreturning the empty object, and in a soft deleting scenario (",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/164"},"AIP-164"),") may return the\nresource itself."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},'service BookApi {\n    rpc DeleteBook (DeleteBookRequest) returns (google.protobuf.Empty) {\n        option (google.api.http) = {\n            delete: "/v1/{name=publishers/*/books/*}"\n        };\n        option (google.api.method_signature) = "name";\n    }\n}\n\nmessage DeleteBookRequest {\n    string name = 1 [\n        (google.api.field_behavior) = REQUIRED,\n        (google.api.resource_reference) = {\n            type: "library.googleapis.com/Book"\n        }];\n}\n')),(0,a.kt)("h3",{id:"custom-method"},"Custom Method"),(0,a.kt)("p",null,"There are also many actions that cannot be simply implemented by the above 5 methods, in which case you can refer\nto ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/136"},"AIP-136")," for the implementation of the custom methods."),(0,a.kt)("p",null,"For batch request scenarios, you can also refer to ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/231"},"AIP-231"),"\n, ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/233"},"AIP-233"),"\n, ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/234"},"AIP-234"),", ",(0,a.kt)("a",{parentName:"p",href:"https://google.aip.dev/235"},"AIP-235")," to design the batch processing method."))}d.isMDXComponent=!0},6474:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/intellij-protobuf-plugin-e0634224543dc985f305b863e210e096.png"},3028:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/intellij-protobuf-plugin_dark-1cae4dff0221aa464d174054c2b2fc5b.png"}}]);